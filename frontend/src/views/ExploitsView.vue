<template>
    <div class="container mt-4">
        <h1>Exploits</h1>
        <button @click="addExploit" class="btn btn-success mt-3 w-100" role="button">
            <i class="bi-plus-lg"></i> Add Exploit
        </button>
        <ExploitCard class="mt-3" v-if="exploits" v-for="exploit in exploits" :prop-exploit="exploit" />
    </div>
</template>

<script>
import * as _ from "lodash";
import ExploitCard from '../components/ExploitCard.vue';
import { api } from '../utils.js';

export default {
    name: 'Exploits',
    components: { ExploitCard },
    data() {
        return {
            exploits: []
        };
    },
    methods: {
        async getExploitsData() {
            let exploits = await (await api.get('/exploits')).json();
            let exploitState = await (await api.get('/exploits/state')).json();

            this.exploits = _.merge(_.keyBy(exploits, 'id'), _.keyBy(exploitState, 'id'));
        },
        async addExploit(){
            await api.post('/exploits', {
                "name": "New Exploit",
                "threads": 8,
                "timeout": 60,
                "runperiod": 30,
                "source": ""
            });
            this.getExploitsData();
        },
    },
    mounted() {
        this.getExploitsData();
    }
}
</script>
